<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mission 2 | Cozy Hub</title>

<style>
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:#000814;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  background:rgba(255,255,255,0.05);
  padding:30px;
  text-align:center;
  width:350px;
  border-radius:18px;
  box-shadow:0 0 20px #00eaff55;
}
.btn{
  padding:12px;
  width:100%;
  margin-top:20px;
  border-radius:10px;
  background:#00eaff;
  color:#00141a;
  border:none;
  cursor:pointer;
  font-weight:700;
}
.hidden{display:none;}
</style>
</head>
<body>

<div class="card">
  <h2>Mission 2 Verification</h2>
  <p id="msg">Checking Mission 2...</p>
  <button id="next" class="btn hidden">Get Key</button>
</div>

<script>
const API = "https://cozyhub-api.aovo4504.workers.dev/verify2";

async function run(){
  const token = new URLSearchParams(location.search).get("token");
  const msg = document.getElementById("msg");
  const btn = document.getElementById("next");

  if(localStorage.getItem("cozy_task1")!=="done"){
    msg.textContent="You cannot skip Mission 1.";
    return;
  }

  if(!token){
    msg.textContent="Invalid access. Please complete Mission 2 again.";
    return;
  }

  try{
    const res = await fetch(API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ token })
    });
    const data = await res.json();

    if(!data.ok){
      msg.textContent="Mission 2 FAILED. Please redo.";
      return;
    }

    localStorage.setItem("cozy_task2","done");
    msg.textContent="Mission 2 Completed âœ”";
    btn.classList.remove("hidden");

  }catch(e){
    msg.textContent="System error.";
  }
}

document.getElementById("next").onclick = () => {
  location.href = "https://aovo4504-bit.github.io/Cozyhub/getkey.html";
};

run();
</script>

</body>
</html>
