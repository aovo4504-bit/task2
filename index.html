<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CozyHub</title>
<style>:root{
  --bg:#050811;
  --card: rgba(7,11,20,.88);
  --cyan:#00eaff;
  --ok:#7dffb0;
  --err:#ff6b6b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: var(--bg);
  color:#fff;
  overflow:hidden;
}
#cozyStars{ position:fixed; inset:0; z-index:-2; }
.bgGlow{
  position:fixed; inset:0; z-index:-3;
  background: radial-gradient(circle at top, #151b2b 0, #050811 55%, #02040a 100%);
}
.langBox{
  position:fixed; top:14px; right:14px; z-index:20;
  display:flex; gap:8px;
}
.langBox button{
  padding:8px 10px; border-radius:10px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.35);
  color:#fff; cursor:pointer;
}
.langBox button.active{
  border-color: rgba(0,234,255,.6);
  box-shadow:0 0 18px rgba(0,234,255,.22);
}
.card{
  width: 430px;
  max-width: 92vw;
  background: var(--card);
  padding: 34px 30px 30px;
  border-radius: 26px;
  text-align: center;
  box-shadow: 0 0 45px rgba(0, 255, 255, 0.22), 0 0 90px rgba(0, 255, 255, 0.10);
  border: 1px solid rgba(0,255,255,0.20);
  margin: 12vh auto 0;
  position:relative;
  z-index:5;
}
.logo{
  width: 110px; height:110px; margin:0 auto 16px; border-radius:50%;
  background: center/cover no-repeat;
  box-shadow: 0 0 18px var(--cyan), 0 0 40px rgba(0,255,255,0.65);
}
h1{
  font-size: 32px; margin: 6px 0 10px; color: var(--cyan);
  letter-spacing: .5px;
  text-shadow: 0 0 10px rgba(0,255,255,.55), 0 0 18px rgba(0,255,255,.30);
}
.sub{opacity:.82; font-size:14px; line-height:1.4}
.btn{
  margin-top: 18px;
  padding: 12px 0;
  width: 100%;
  font-weight: 700;
  border-radius: 14px;
  border: none;
  cursor: pointer;
  background: linear-gradient(135deg,#7df9ff,#7dffb0);
  color: #001015;
  font-size: 16px;
  box-shadow: 0 0 24px rgba(0,255,255,0.32);
  transition: transform .18s, box-shadow .18s;
}
.btn:hover{transform:translateY(-1px) scale(1.02); box-shadow:0 0 34px rgba(0,255,255,0.45)}
.btn:active{transform:scale(.98)}
.status-success,.status-error{
  display:flex; align-items:center; justify-content:center;
  gap:10px; margin:18px 0 6px;
  font-size:18px; font-weight:700;
  opacity:0; transform:translateY(6px);
  animation:fadeInUp .35s ease forwards;
}
.status-success{color:var(--ok); text-shadow:0 0 12px rgba(125,255,176,.55)}
.status-error{color:var(--err); text-shadow:0 0 12px rgba(255,107,107,.55)}
.badge{
  width:28px;height:28px;border-radius:50%;
  display:grid; place-items:center;
  font-weight:900;color:#fff;
}
.badge.ok{
  background: radial-gradient(circle at 30% 30%, #7dffb0, #1fdc7c);
  box-shadow:0 0 14px rgba(31,220,124,.8);
  color:#0b3;
}
.badge.err{
  background: radial-gradient(circle at 30% 30%, #ff9a9a, #ff3b3b);
  box-shadow:0 0 14px rgba(255,59,59,.8);
  color:#fff;
}
@keyframes fadeInUp{to{opacity:1; transform:translateY(0)}}
.small{margin-top:10px; font-size:11px; opacity:.55}
.keybox{
  margin-top: 18px;
  padding: 13px 14px;
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.62);
  font-size: 18px;
  min-height: 26px;
  letter-spacing: 1px;
  text-align: center;
  border: 1px solid rgba(0,255,255,0.32);
  box-shadow: inset 0 0 22px rgba(0,255,255,0.25);
  word-break: break-all;
}
.row{display:flex; gap:10px; margin-top:12px}
.row .btn{margin-top:0}
.iconRow{margin-top:18px; display:flex; justify-content:center; gap:16px}
.iconRow a{
  width:42px; height:42px; display:grid; place-items:center;
  border-radius:14px;
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.14);
  box-shadow:0 0 18px rgba(0,234,255,0.10);
  transition: transform .18s, box-shadow .18s, border-color .18s;
}
.iconRow a:hover{
  transform:translateY(-2px) scale(1.06);
  border-color: rgba(0,234,255,.45);
  box-shadow:0 0 26px rgba(0,234,255,0.22);
}
.iconRow img{width:22px; height:22px; filter: drop-shadow(0 0 10px rgba(0,234,255,0.20));}
</style>
</head>
<body>
<div class="bgGlow"></div>
<canvas id="cozyStars"></canvas>

<div class="langBox">
  <button id="langEN" onclick="setLang('en')">EN</button>
  <button id="langVI" onclick="setLang('vi')">VI</button>
</div>

<div class="card">
  <div class="logo" style="background-image:url('https://raw.githubusercontent.com/aovo4504-bit/Cozyhub/refs/heads/main/IMG_0830.png');"></div>
  <h1 data-i18n="cozyhub">CozyHub</h1>

  <div id="statusWrap">
    <div class="sub" data-i18n="checking"></div>
  </div>

  <button class="btn" id="nextBtn" style="display:none;" data-i18n="get_key"></button>
  <div class="small"></div>
</div>

<script>/* CozyHub v2 - Star network background (connect only when near) */
(function(){
  const canvas = document.getElementById("cozyStars");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");
  let W=0,H=0,stars=[];
  const N = 85;
  const MAX_LINK = 125;

  function resize(){
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resize);
  resize();

  function rand(min,max){ return min + Math.random()*(max-min); }
  stars = Array.from({length:N}).map(()=>({
    x: rand(0,W), y: rand(0,H),
    vx: rand(-0.35,0.35), vy: rand(-0.35,0.35),
    r: rand(1.2,2.0)
  }));

  function tick(){
    ctx.clearRect(0,0,W,H);

    for(const s of stars){
      s.x += s.vx; s.y += s.vy;
      if(s.x<0||s.x>W) s.vx *= -1;
      if(s.y<0||s.y>H) s.vy *= -1;
    }

    for(let i=0;i<stars.length;i++){
      for(let j=i+1;j<stars.length;j++){
        const a=stars[i], b=stars[j];
        const dx=a.x-b.x, dy=a.y-b.y;
        const d=Math.hypot(dx,dy);
        if(d<MAX_LINK){
          const alpha = (1 - d/MAX_LINK) * 0.18;
          ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
          ctx.beginPath();
          ctx.moveTo(a.x,a.y);
          ctx.lineTo(b.x,b.y);
          ctx.stroke();
        }
      }
    }

    ctx.fillStyle = "rgba(255,255,255,0.9)";
    for(const s of stars){
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fill();
    }

    requestAnimationFrame(tick);
  }
  tick();
})();</script>
<script>
/* CozyHub v2 - i18n (default EN, switchable) */
const TEXT = {
  en: {
    cozyhub: "CozyHub",
    home_sub: "Click below to start missions and get your key.",
    start: "Start Mission",
    checking: "Checking...",
    continue_m2: "Continue to Mission 2",
    get_key: "Get Key",
    m1_done: "Mission 1 completed",
    m2_done: "Mission 2 completed",
    m1_required: "Mission 1 required",
    m2_required: "Mission 2 not completed",
    invalid: "Invalid or expired. Redirecting...",
    system_maint: "System is under maintenance.",
    copy: "Copy",
    copied: "Copied!",
    key_title: "Your Key",
    key_loading: "Loading key...",
    key_error: "Unable to get key.",
    back_home: "Back to Home"
  },
  vi: {
    cozyhub: "CozyHub",
    home_sub: "Bấm nút bên dưới để bắt đầu nhiệm vụ và nhận key.",
    start: "Bắt đầu",
    checking: "Đang kiểm tra...",
    continue_m2: "Tiếp tục nhiệm vụ 2",
    get_key: "Lấy Key",
    m1_done: "Đã hoàn thành nhiệm vụ 1",
    m2_done: "Đã hoàn thành nhiệm vụ 2",
    m1_required: "Cần hoàn thành nhiệm vụ 1",
    m2_required: "Chưa hoàn thành nhiệm vụ 2",
    invalid: "Không hợp lệ hoặc hết hạn. Đang chuyển hướng...",
    system_maint: "Hệ thống đang bảo trì.",
    copy: "Sao chép",
    copied: "Đã sao chép!",
    key_title: "Key của bạn",
    key_loading: "Đang lấy key...",
    key_error: "Không thể lấy key.",
    back_home: "Về trang chủ"
  }
};

let LANG = localStorage.getItem("cozy_lang") || "en";
function t(k){ return (TEXT[LANG] && TEXT[LANG][k]) ? TEXT[LANG][k] : (TEXT.en[k] || k); }
function setLang(lang){ LANG = lang; localStorage.setItem("cozy_lang", lang); renderLang(); updateLangButtons(); }
function renderLang(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    el.textContent = t(el.dataset.i18n);
  });
}
function updateLangButtons(){
  document.getElementById('langEN').classList.toggle('active', LANG==='en');
  document.getElementById('langVI').classList.toggle('active', LANG==='vi');
}
renderLang(); updateLangButtons();

function showOk(msgKey){
  const wrap=document.getElementById('statusWrap');
  wrap.innerHTML = `
    <div class="status-success">
      <div class="badge ok">✓</div>
      <div>${t(msgKey)}</div>
    </div>`;
}
function showErr(msgKey){
  const wrap=document.getElementById('statusWrap');
  wrap.innerHTML = `
    <div class="status-error">
      <div class="badge err">✕</div>
      <div>${t(msgKey)}</div>
    </div>`;
}
function hardGo(url){ window.location.replace(url); }

(async ()=>{
  try{
    const p = new URLSearchParams(location.search);
    const token = (p.get('token')||'').trim();

    if(!token){
      showErr('invalid');
      setTimeout(()=>hardGo('/'), 1200);
      return;
    }

    const STATUS = "https://cozyhub-status.aovo4504.workers.dev/";
    const res = await fetch(STATUS + "status?task=2&token=" + encodeURIComponent(token));
    const data = await res.json();

    if(data.maint){
      showErr('system_maint');
      return;
    }

    if(2===1){
      if(!data.nv1){
        showErr('m1_required');
        setTimeout(()=>hardGo('/'), 1200);
        return;
      }
      showOk('m1_done');
      const btn=document.getElementById('nextBtn');
      btn.style.display='block';
      btn.onclick=()=>{ window.location.href = data.next; };
    } else {
      if(!data.nv1){
        showErr('m1_required');
        setTimeout(()=>hardGo('/'), 1200);
        return;
      }
      if(!data.nv2){
        showErr('m2_required');
        setTimeout(()=>hardGo('/task1/index.html?token='+encodeURIComponent(token)), 1200);
        return;
      }
      showOk('m2_done');
      const btn=document.getElementById('nextBtn');
      btn.style.display='block';
      btn.onclick=()=>{ window.location.href = data.next; };
    }

  }catch(e){
    showErr('invalid');
    setTimeout(()=>hardGo('/'), 1200);
  }
})();
</script>
</body>
</html>
