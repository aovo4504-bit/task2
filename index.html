<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cozy Hub – Mission 2 Check</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  margin:0;background:#050811;color:#fff;
  font-family:'Poppins',sans-serif;
  display:flex;justify-content:center;align-items:center;
  height:100vh;overflow:hidden;position:relative;
}
body::before{
  content:"";position:absolute;inset:-40%;
  background:
    radial-gradient(circle at 10% 0%,rgba(0,255,255,.2),transparent 55%),
    radial-gradient(circle at 90% 100%,rgba(0,160,255,.18),transparent 55%);
  filter:blur(16px);z-index:-2;opacity:.9;
}
.card{
  width:380px;max-width:94vw;
  background:rgba(7,11,20,.94);
  border-radius:26px;
  padding:30px 26px 24px;
  text-align:center;
  border:1px solid rgba(0,255,255,.35);
  box-shadow:0 0 45px rgba(0,255,255,.35);
}
.logo{
  width:90px;height:90px;margin:0 auto 10px;
  border-radius:50%;
  background:url("https://raw.githubusercontent.com/aovo4504-bit/Cozyhub/refs/heads/main/IMG_0830.png") center/cover;
  box-shadow:0 0 18px cyan;
}
.title{
  font-size:24px;margin-bottom:6px;
  color:#00eaff;font-weight:600;
  text-shadow:0 0 10px rgba(0,255,255,.8);
}
.sub{font-size:14px;opacity:.9;margin-bottom:22px;min-height:38px;}
.btn{
  width:100%;padding:11px 0;
  border:none;border-radius:11px;
  background:linear-gradient(90deg,#00eaff,#00ffa3);
  color:#001015;font-weight:600;font-size:15px;
  cursor:pointer;margin-top:8px;
  box-shadow:0 0 22px rgba(0,255,255,.7);
  transition:.2s;
}
.btn:hover{transform:scale(1.03);}
.note{margin-top:10px;font-size:12px;opacity:.8;}
.hidden{display:none;}
</style>
</head>
<body>

<div class="card">
  <div class="logo"></div>
  <div class="title">Mission 2</div>
  <div class="sub" id="subText">Checking Mission 2...</div>

  <button class="btn hidden" id="btnNext">Continue to Get Key</button>
  <div class="note" id="noteText"></div>
</div>

<script>
const VERIFY2_URL = "https://cozyhub-verify2.aovo4504.workers.dev/";
const HOME_URL    = "https://aovo4504-bit.github.io/CozyHub.key/";
const GETKEY_URL  = "https://aovo4504-bit.github.io/Cozyhub/getkey.html";

async function checkMission2(){
  const t1 = localStorage.getItem("cozy_task1");
  if(t1 !== "done"){
    alert("You must complete Mission 1 first.");
    location.href = HOME_URL;
    return;
  }

  const params = new URLSearchParams(location.search);
  const token  = params.get("token") || "";

  const sub  = document.getElementById("subText");
  const btn  = document.getElementById("btnNext");
  const note = document.getElementById("noteText");

  if (!token){
    sub.textContent  = "You must complete Mission 2 on the ad page before coming here.";
    note.textContent = "Please go back and finish the ad task first.";
    return;
  }

  try{
    const res = await fetch(VERIFY2_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ token, hwid:"" })
    });
    const data = await res.json();

    if(!data.ok){
      sub.textContent  = "Mission 2 NOT verified. Please finish it properly.";
      note.textContent = data.error || "";
      return;
    }

    localStorage.setItem("cozy_task2","done");
    localStorage.setItem("cozy_task_done_at", Date.now());

    sub.textContent  = "Mission 2 verified successfully ✓";
    note.textContent = "Click below to go to the key page.";
    btn.classList.remove("hidden");

  }catch(e){
    sub.textContent  = "System error. Please try again.";
    note.textContent = "";
  }
}

document.getElementById("btnNext").onclick = () => {
  location.href = GETKEY_URL;
};

window.addEventListener("load", checkMission2);
</script>

</body>
</html>
